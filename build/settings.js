(()=>{"use strict";var e={n:a=>{var s=a&&a.__esModule?()=>a.default:()=>a;return e.d(s,{a:s}),s},d:(a,s)=>{for(var l in s)e.o(s,l)&&!e.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:s[l]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.wp.element,s=window.wp.components,l=window.wp.apiFetch;var o=e.n(l);const i=window.wp.i18n,r=window.ReactJSXRuntime;function t({value:e,label:a,color:s}){return(0,r.jsxs)("div",{className:"vmfa-stat-item",children:[(0,r.jsx)("div",{className:"vmfa-stat-value",style:s?{color:s}:void 0,children:e}),(0,r.jsx)("div",{className:"vmfa-stat-label",children:a})]})}function n({stats:e={}}){const{totalMedia:a=0,needsReview:s=0,approved:l=0,rolesConfigured:o=0}=e;return(0,r.jsxs)("div",{className:"vmfa-stats-card vmfa-card",children:[(0,r.jsx)(t,{value:a,label:(0,i.__)("Total Media","vmfa-editorial-workflow")}),(0,r.jsx)(t,{value:s,label:(0,i.__)("Needs Review","vmfa-editorial-workflow"),color:s>0?"#d63638":void 0}),(0,r.jsx)(t,{value:l,label:(0,i.__)("Approved","vmfa-editorial-workflow"),color:l>0?"#008a20":void 0}),(0,r.jsx)(t,{value:o,label:(0,i.__)("Roles Configured","vmfa-editorial-workflow")})]})}function d(e,{emptyLabel:a="",excludeSystem:s=!1,filter:l=null}={}){const o=[];a&&o.push({value:"",label:a});const i=(a,r="")=>{e.filter(e=>!(e.parent!==a||s&&e.isSystem||l&&!l(e))).forEach(e=>{o.push({value:String(e.id),label:r+e.name}),i(e.id,r+"— ")})};return i(0),o}function c({folders:e=[],workflow:l={},onChange:o}){const{editorsCanReview:t=!0,approvedFolder:n=""}=l,c=(0,a.useMemo)(()=>d(e,{emptyLabel:(0,i.__)('Use default "Approved" folder',"vmfa-editorial-workflow"),excludeSystem:!0}),[e]);return(0,r.jsxs)("div",{className:"vmfa-card",children:[(0,r.jsx)("div",{className:"vmfa-card-header",children:(0,r.jsx)("h3",{children:(0,i.__)("Workflow Settings","vmfa-editorial-workflow")})}),(0,r.jsxs)("div",{className:"vmfa-card-body",children:[(0,r.jsx)("p",{className:"vmfa-card-description",children:(0,i.__)('Media uploaded by non-admin roles will be placed in the "Needs Review" folder for editorial approval.',"vmfa-editorial-workflow")}),(0,r.jsxs)("div",{className:"vmfa-workflow-settings",children:[(0,r.jsx)(s.SelectControl,{label:(0,i.__)("Approved folder","vmfa-editorial-workflow"),help:(0,i.__)("Destination folder for approved media.","vmfa-editorial-workflow"),value:String(n||""),options:c,onChange:e=>{o({...l,approvedFolder:e?parseInt(e,10):""})}}),(0,r.jsx)(s.CheckboxControl,{label:(0,i.__)("Allow Editors to review media","vmfa-editorial-workflow"),help:(0,i.__)("Editors can access the Review page. Otherwise, only Administrators can review.","vmfa-editorial-workflow"),checked:t,onChange:e=>{o({...l,editorsCanReview:e})}})]})]})]})}const m=window.React,f=window.wp.primitives,v=(0,m.createElement)(f.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,m.createElement)(f.Path,{d:"m19 7.5h-7.628c-.3089-.87389-1.1423-1.5-2.122-1.5-.97966 0-1.81309.62611-2.12197 1.5h-2.12803v1.5h2.12803c.30888.87389 1.14231 1.5 2.12197 1.5.9797 0 1.8131-.62611 2.122-1.5h7.628z"}),(0,m.createElement)(f.Path,{d:"m19 15h-2.128c-.3089-.8739-1.1423-1.5-2.122-1.5s-1.8131.6261-2.122 1.5h-7.628v1.5h7.628c.3089.8739 1.1423 1.5 2.122 1.5s1.8131-.6261 2.122-1.5h2.128z"}));function h({roles:e=[],folders:l=[],actions:o=[],permissions:t={},onChange:n}){const[d,c]=(0,a.useState)({}),m=["administrator"],f=["editor"],h=(0,a.useCallback)(e=>m.includes(e),[]),u=(0,a.useCallback)(e=>f.includes(e),[]),w=(0,a.useCallback)(e=>Object.values(t).some(a=>void 0!==a[e]),[t]),k=(0,a.useMemo)(()=>{const e=[],a=(s,o=0)=>{e.push({...s,depth:o}),l.filter(e=>e.parent===s.id).forEach(e=>a(e,o+1))};return l.filter(e=>0===e.parent).forEach(e=>a(e,0)),e},[l]),p=(0,a.useCallback)((e,a,s)=>{var l;return null!==(l=t[e]?.[a]?.includes(s))&&void 0!==l&&l},[t]),x=(0,a.useCallback)((e,a,s,i)=>{const r={...t};u(a)&&!w(a)&&l.forEach(e=>{r[e.id]||(r[e.id]={}),r[e.id][a]=o.map(e=>e.key)}),r[e]||(r[e]={}),r[e][a]||(r[e][a]=[]);const d=[...r[e][a]];if(i&&!d.includes(s))d.push(s);else if(!i){const e=d.indexOf(s);e>-1&&d.splice(e,1)}r[e][a]=d,n(r)},[t,l,o,u,w,n]),b=(0,a.useCallback)(e=>{const a={...t};l.forEach(s=>{a[s.id]||(a[s.id]={}),a[s.id][e]=o.map(e=>e.key)}),n(a)},[t,l,o,n]),j=(0,a.useCallback)(e=>{const a={...t};l.forEach(s=>{a[s.id]||(a[s.id]={}),a[s.id][e]=[]}),n(a)},[t,l,n]),_=(0,a.useCallback)((e,a)=>{const s={...t};l.forEach(l=>{s[l.id]||(s[l.id]={}),s[l.id][e]||(s[l.id][e]=[]),s[l.id][e].includes(a)||(s[l.id][e]=[...s[l.id][e],a])}),n(s)},[t,l,n]),y=(0,a.useCallback)((e,a)=>{const s={...t};if(u(e)){const i=o.filter(e=>e.key!==a).map(e=>e.key);l.forEach(l=>{s[l.id]||(s[l.id]={}),void 0===s[l.id][e]?s[l.id][e]=i:s[l.id][e]=s[l.id][e].filter(e=>e!==a)})}else Object.keys(s).forEach(l=>{s[l][e]&&(s[l][e]=s[l][e].filter(e=>e!==a))});n(s)},[t,l,o,u,n]),g=(0,a.useCallback)((e,a)=>!(!u(e)||w(e))||l.every(s=>t[s.id]?.[e]?.includes(a)),[t,l,u,w]),N=(0,a.useCallback)((e,a)=>!(!u(e)||w(e))||l.some(s=>t[s.id]?.[e]?.includes(a)),[t,l,u,w]),C=(0,a.useCallback)((e,a)=>{g(e,a)?y(e,a):_(e,a)},[g,y,_]),S=(0,a.useCallback)(e=>{let a=0;return Object.values(t).forEach(s=>{s[e]&&(a+=s[e].length)}),a},[t]),E=(0,a.useCallback)(e=>{const a=o.map(a=>({title:`${(0,i.__)("Grant","vmfa-editorial-workflow")} "${a.label}" ${(0,i.__)("to all folders","vmfa-editorial-workflow")}`,onClick:()=>_(e,a.key)})),s=o.map(a=>({title:`${(0,i.__)("Revoke","vmfa-editorial-workflow")} "${a.label}" ${(0,i.__)("from all folders","vmfa-editorial-workflow")}`,onClick:()=>y(e,a.key)}));return[{title:(0,i.__)("Grant all permissions","vmfa-editorial-workflow"),onClick:()=>b(e)},{title:(0,i.__)("Revoke all permissions","vmfa-editorial-workflow"),onClick:()=>j(e)},...a,...s]},[o,b,j,_,y]);return e.length&&l.length?(0,r.jsxs)("div",{className:"vmfa-card",children:[(0,r.jsx)("div",{className:"vmfa-card-header",children:(0,r.jsx)("h3",{children:(0,i.__)("Folder Permissions","vmfa-editorial-workflow")})}),(0,r.jsxs)("div",{className:"vmfa-card-body",children:[(0,r.jsx)("p",{className:"vmfa-card-description",children:(0,i.__)("Configure which roles can access each folder. Administrators and Editors have full access by default. Click column headers to toggle all.","vmfa-editorial-workflow")}),(0,r.jsx)("div",{className:"vmfa-permissions-list",children:e.map(e=>{const a=h(e.key),l=u(e.key),t=w(e.key),n=a||l&&!t;return(0,r.jsxs)("div",{className:"vmfa-permission-role",children:[(0,r.jsxs)("div",{className:"vmfa-role-header-row",children:[(0,r.jsxs)("button",{type:"button",className:"vmfa-role-header",onClick:()=>{return a=e.key,void c(e=>({...e,[a]:!e[a]}));var a},"aria-expanded":d[e.key],children:[(0,r.jsx)("span",{className:"vmfa-role-toggle",children:(0,r.jsx)("span",{className:`dashicons dashicons-arrow-${d[e.key]?"down":"right"}-alt2`})}),(0,r.jsx)("span",{className:"vmfa-role-name",children:e.name}),n?(0,r.jsxs)("span",{className:"vmfa-role-full-access",children:[(0,i.__)("Full access","vmfa-editorial-workflow"),l&&!a&&(0,r.jsx)("span",{className:"vmfa-default-badge",children:(0,i.__)("default","vmfa-editorial-workflow")})]}):(0,r.jsxs)("span",{className:"vmfa-role-count",children:[S(e.key)," ",(0,i.__)("permissions","vmfa-editorial-workflow")]})]}),!a&&(0,r.jsx)(s.DropdownMenu,{icon:v,label:(0,i.__)("Bulk actions","vmfa-editorial-workflow"),controls:E(e.key),className:"vmfa-bulk-menu"})]}),d[e.key]&&(0,r.jsxs)("div",{className:"vmfa-role-folders",children:[a&&(0,r.jsxs)("p",{className:"vmfa-full-access-notice",children:[(0,r.jsx)("span",{className:"dashicons dashicons-yes-alt"}),(0,i.__)("This role has full access to all folders. Permissions cannot be restricted.","vmfa-editorial-workflow")]}),l&&!a&&!t&&(0,r.jsxs)("p",{className:"vmfa-default-access-notice",children:[(0,r.jsx)("span",{className:"dashicons dashicons-info"}),(0,i.__)("This role has full access by default. Configure permissions below to override.","vmfa-editorial-workflow")]}),(0,r.jsxs)("table",{className:"vmfa-folders-table",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:(0,i.__)("Folder","vmfa-editorial-workflow")}),o.map(s=>{const l=n||g(e.key,s.key),o=N(e.key,s.key);return(0,r.jsx)("th",{className:"vmfa-action-header-cell",children:a?(0,r.jsxs)("span",{className:"vmfa-column-label",children:[(0,r.jsx)("span",{className:"vmfa-column-indicator all"}),s.label]}):(0,r.jsxs)("button",{type:"button",className:"vmfa-column-toggle",onClick:()=>C(e.key,s.key),title:l?(0,i.__)("Revoke all","vmfa-editorial-workflow"):(0,i.__)("Grant all","vmfa-editorial-workflow"),children:[(0,r.jsx)("span",{className:"vmfa-column-indicator "+(l?"all":o?"some":"")}),s.label]})},s.key)})]})}),(0,r.jsx)("tbody",{children:k.map(l=>(0,r.jsxs)("tr",{className:l.isSystem?"vmfa-system-folder":"",children:[(0,r.jsxs)("td",{style:{paddingLeft:16*l.depth+8+"px"},children:[l.isSystem&&(0,r.jsx)("span",{className:"dashicons dashicons-lock",title:(0,i.__)("System folder","vmfa-editorial-workflow")}),l.name]}),o.map(o=>(0,r.jsx)("td",{className:"vmfa-checkbox-cell",children:(0,r.jsx)(s.CheckboxControl,{checked:n||p(l.id,e.key,o.key),onChange:a=>x(l.id,e.key,o.key,a),disabled:a})},o.key))]},l.id))})]})]})]},e.key)})})]})]}):(0,r.jsxs)("div",{className:"vmfa-card",children:[(0,r.jsx)("div",{className:"vmfa-card-header",children:(0,r.jsx)("h3",{children:(0,i.__)("Folder Permissions","vmfa-editorial-workflow")})}),(0,r.jsx)("div",{className:"vmfa-card-body",children:(0,r.jsx)("p",{className:"vmfa-empty-state",children:(0,i.__)("No roles or folders available.","vmfa-editorial-workflow")})})]})}function u({roles:e=[],folders:l=[],inboxMap:o={},onChange:t}){const n=(0,a.useMemo)(()=>d(l,{emptyLabel:(0,i.__)("Use workflow inbox","vmfa-editorial-workflow")}),[l]);return e.length?(0,r.jsxs)("div",{className:"vmfa-card",children:[(0,r.jsx)("div",{className:"vmfa-card-header",children:(0,r.jsx)("h3",{children:(0,i.__)("Role Inbox Folders","vmfa-editorial-workflow")})}),(0,r.jsxs)("div",{className:"vmfa-card-body",children:[(0,r.jsx)("p",{className:"vmfa-card-description",children:(0,i.__)('Override the default workflow inbox for specific roles. If not set, uploads will go to the "Needs Review" folder.',"vmfa-editorial-workflow")}),(0,r.jsx)("div",{className:"vmfa-inbox-grid",children:e.map(e=>(0,r.jsx)("div",{className:"vmfa-inbox-item",children:(0,r.jsx)(s.SelectControl,{label:e.name,value:String(o[e.key]||""),options:n,onChange:a=>((e,a)=>{const s={...o};a?s[e]=parseInt(a,10):delete s[e],t(s)})(e.key,a)})},e.key))})]})]}):null}function w(){const[e,l]=(0,a.useState)(!0),[t,d]=(0,a.useState)(!1),[m,f]=(0,a.useState)(null),[v,w]=(0,a.useState)(!1),[k,p]=(0,a.useState)({}),[x,b]=(0,a.useState)({permissions:{},inbox:{},workflow:{enabled:!0,needsReviewFolder:"",approvedFolder:""}}),{roles:j,folders:_,actions:y,i18n:g}=window.vmfaSettings||{};(0,a.useEffect)(()=>{N(),C()},[]),(0,a.useEffect)(()=>{if("success"===m?.status&&!v){const e=setTimeout(()=>{w(!0),setTimeout(()=>{f(null),w(!1)},300)},3e3);return()=>clearTimeout(e)}},[m,v]);const N=(0,a.useCallback)(async()=>{l(!0);try{const e=await o()({path:"/vmfa-editorial/v1/settings"});b(e)}catch(e){f({status:"error",message:e.message||g?.error||"Error loading settings."})}finally{l(!1)}},[g]),C=(0,a.useCallback)(async()=>{try{const e=await o()({path:"/vmfa-editorial/v1/stats"});p(e)}catch(e){console.warn("Could not load stats:",e)}},[]),S=(0,a.useCallback)(async()=>{d(!0),f(null);try{const e=await o()({path:"/vmfa-editorial/v1/settings",method:"POST",data:x});b(e),f({status:"success",message:g?.saved||"Settings saved."}),C()}catch(e){f({status:"error",message:e.message||g?.error||"Error saving settings."})}finally{d(!1)}},[x,g,C]),E=(0,a.useCallback)(e=>{b(a=>({...a,permissions:e}))},[]),R=(0,a.useCallback)(e=>{b(a=>({...a,inbox:e}))},[]),M=(0,a.useCallback)(e=>{b(a=>({...a,workflow:e}))},[]);return e?(0,r.jsxs)("div",{className:"vmfa-settings-loading",children:[(0,r.jsx)(s.Spinner,{}),(0,r.jsx)("p",{children:(0,i.__)("Loading settings…","vmfa-editorial-workflow")})]}):(0,r.jsxs)("div",{className:"vmfa-settings-panel",children:[m&&(0,r.jsx)(s.Notice,{status:m.status,isDismissible:!0,onRemove:()=>{w(!0),setTimeout(()=>{f(null),w(!1)},300)},className:"vmfa-notice"+(v?" is-dismissing":""),children:m.message}),(0,r.jsx)(n,{stats:k}),(0,r.jsx)(c,{folders:_,workflow:x.workflow,onChange:M}),(0,r.jsx)(h,{roles:j,folders:_,actions:y,permissions:x.permissions,onChange:E}),(0,r.jsx)(u,{roles:j,folders:_,inboxMap:x.inbox,onChange:R}),(0,r.jsx)("div",{className:"vmfa-settings-actions",children:(0,r.jsx)(s.Button,{variant:"primary",onClick:S,isBusy:t,disabled:t,children:t?(0,i.__)("Saving…","vmfa-editorial-workflow"):(0,i.__)("Save Changes","vmfa-editorial-workflow")})})]})}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("vmfa-settings-root");e&&(0,a.createRoot)(e).render((0,r.jsx)(w,{}))})})();