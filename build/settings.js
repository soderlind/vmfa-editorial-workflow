(()=>{"use strict";var e={n:a=>{var l=a&&a.__esModule?()=>a.default:()=>a;return e.d(l,{a:l}),l},d:(a,l)=>{for(var t in l)e.o(l,t)&&!e.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:l[t]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.React,l=window.wp.element,t=window.wp.components,o=window.wp.apiFetch;var r=e.n(o);const s=window.wp.i18n;function n({value:e,label:l,color:t}){return(0,a.createElement)("div",{className:"vmfa-stat-item"},(0,a.createElement)("div",{className:"vmfa-stat-value",style:t?{color:t}:void 0},e),(0,a.createElement)("div",{className:"vmfa-stat-label"},l))}function i({stats:e={}}){const{totalMedia:l=0,needsReview:t=0,approved:o=0,rolesConfigured:r=0}=e;return(0,a.createElement)("div",{className:"vmfa-stats-card vmfa-card"},(0,a.createElement)(n,{value:l,label:(0,s.__)("Total Media","vmfa-editorial-workflow")}),(0,a.createElement)(n,{value:t,label:(0,s.__)("Needs Review","vmfa-editorial-workflow"),color:t>0?"#d63638":void 0}),(0,a.createElement)(n,{value:o,label:(0,s.__)("Approved","vmfa-editorial-workflow"),color:o>0?"#00a32a":void 0}),(0,a.createElement)(n,{value:r,label:(0,s.__)("Roles Configured","vmfa-editorial-workflow")}))}function c({folders:e=[],workflow:o={},onChange:r}){const{enabled:n=!0,needsReviewFolder:i="",approvedFolder:c=""}=o,m=(0,l.useMemo)(()=>{const a={};return e.forEach(e=>{a[e.id]=e.name}),e=>a[e]||(0,s.__)("Not configured","vmfa-editorial-workflow")},[e]);return(0,a.createElement)("div",{className:"vmfa-card"},(0,a.createElement)("div",{className:"vmfa-card-header"},(0,a.createElement)("h3",null,(0,s.__)("Workflow Folders","vmfa-editorial-workflow")),(0,a.createElement)(t.ToggleControl,{checked:n,onChange:e=>{r({...o,enabled:e})}})),n&&(0,a.createElement)("div",{className:"vmfa-card-body"},(0,a.createElement)("p",{className:"vmfa-card-description"},(0,s.__)('Media uploaded by non-admin roles will be placed in the "Needs Review" folder for editorial approval. Approved media can be moved to the appropriate destination folder.',"vmfa-editorial-workflow")),(0,a.createElement)("div",{className:"vmfa-workflow-info"},(0,a.createElement)("div",{className:"vmfa-workflow-folder"},(0,a.createElement)("span",{className:"vmfa-folder-icon dashicons dashicons-category"}),(0,a.createElement)("div",{className:"vmfa-folder-details"},(0,a.createElement)("strong",null,(0,s.__)("Needs Review","vmfa-editorial-workflow")),(0,a.createElement)("span",{className:"vmfa-folder-path"},i?`Workflow / ${m(i)}`:(0,s.__)("Will be created on first use","vmfa-editorial-workflow")))),(0,a.createElement)("div",{className:"vmfa-workflow-folder"},(0,a.createElement)("span",{className:"vmfa-folder-icon dashicons dashicons-yes-alt"}),(0,a.createElement)("div",{className:"vmfa-folder-details"},(0,a.createElement)("strong",null,(0,s.__)("Approved","vmfa-editorial-workflow")),(0,a.createElement)("span",{className:"vmfa-folder-path"},c?`Workflow / ${m(c)}`:(0,s.__)("Will be created on first use","vmfa-editorial-workflow")))))))}function m({roles:e=[],folders:o=[],actions:r=[],permissions:n={},onChange:i}){const[c,m]=(0,l.useState)({}),d=(0,l.useMemo)(()=>{const e=[],a=(l,t=0)=>{e.push({...l,depth:t}),o.filter(e=>e.parent===l.id).forEach(e=>a(e,t+1))};return o.filter(e=>0===e.parent).forEach(e=>a(e,0)),e},[o]),f=(0,l.useCallback)((e,a,l)=>{var t;return null!==(t=n[e]?.[a]?.includes(l))&&void 0!==t&&t},[n]),v=(0,l.useCallback)((e,a,l,t)=>{const o={...n};o[e]||(o[e]={}),o[e][a]||(o[e][a]=[]);const r=[...o[e][a]];if(t&&!r.includes(l))r.push(l);else if(!t){const e=r.indexOf(l);e>-1&&r.splice(e,1)}o[e][a]=r,0===r.length&&delete o[e][a],0===Object.keys(o[e]).length&&delete o[e],i(o)},[n,i]),w=(0,l.useCallback)(e=>{const a={...n};o.forEach(l=>{a[l.id]||(a[l.id]={}),a[l.id][e]=r.map(e=>e.key)}),i(a)},[n,o,r,i]),u=(0,l.useCallback)(e=>{const a={...n};Object.keys(a).forEach(l=>{a[l][e]&&delete a[l][e],0===Object.keys(a[l]).length&&delete a[l]}),i(a)},[n,i]),k=(0,l.useCallback)((e,a)=>{const l={...n};o.forEach(t=>{l[t.id]||(l[t.id]={}),l[t.id][e]||(l[t.id][e]=[]),l[t.id][e].includes(a)||(l[t.id][e]=[...l[t.id][e],a])}),i(l)},[n,o,i]),p=(0,l.useCallback)((e,a)=>{const l={...n};Object.keys(l).forEach(t=>{l[t][e]&&(l[t][e]=l[t][e].filter(e=>e!==a),0===l[t][e].length&&delete l[t][e]),0===Object.keys(l[t]).length&&delete l[t]}),i(l)},[n,i]),E=(0,l.useCallback)((e,a)=>o.every(l=>n[l.id]?.[e]?.includes(a)),[n,o]),h=(0,l.useCallback)((e,a)=>o.some(l=>n[l.id]?.[e]?.includes(a)),[n,o]),b=(0,l.useCallback)((e,a)=>{E(e,a)?p(e,a):k(e,a)},[E,p,k]),y=(0,l.useCallback)(e=>{let a=0;return Object.values(n).forEach(l=>{l[e]&&(a+=l[e].length)}),a},[n]),_=(0,l.useCallback)(e=>{const a=r.map(a=>({title:`${(0,s.__)("Grant","vmfa-editorial-workflow")} "${a.label}" ${(0,s.__)("to all folders","vmfa-editorial-workflow")}`,onClick:()=>k(e,a.key)})),l=r.map(a=>({title:`${(0,s.__)("Revoke","vmfa-editorial-workflow")} "${a.label}" ${(0,s.__)("from all folders","vmfa-editorial-workflow")}`,onClick:()=>p(e,a.key)}));return[{title:(0,s.__)("Grant all permissions","vmfa-editorial-workflow"),onClick:()=>w(e)},{title:(0,s.__)("Revoke all permissions","vmfa-editorial-workflow"),onClick:()=>u(e)},...a,...l]},[r,w,u,k,p]);return e.length&&o.length?(0,a.createElement)("div",{className:"vmfa-card"},(0,a.createElement)("div",{className:"vmfa-card-header"},(0,a.createElement)("h3",null,(0,s.__)("Folder Permissions","vmfa-editorial-workflow"))),(0,a.createElement)("div",{className:"vmfa-card-body"},(0,a.createElement)("p",{className:"vmfa-card-description"},(0,s.__)("Configure which roles can access each folder. Administrators always have full access. Click column headers to toggle all.","vmfa-editorial-workflow")),(0,a.createElement)("div",{className:"vmfa-permissions-list"},e.map(e=>(0,a.createElement)("div",{key:e.key,className:"vmfa-permission-role"},(0,a.createElement)("div",{className:"vmfa-role-header-row"},(0,a.createElement)("button",{type:"button",className:"vmfa-role-header",onClick:()=>{return a=e.key,void m(e=>({...e,[a]:!e[a]}));var a},"aria-expanded":c[e.key]},(0,a.createElement)("span",{className:"vmfa-role-toggle"},(0,a.createElement)("span",{className:`dashicons dashicons-arrow-${c[e.key]?"down":"right"}-alt2`})),(0,a.createElement)("span",{className:"vmfa-role-name"},e.name),(0,a.createElement)("span",{className:"vmfa-role-count"},y(e.key)," ",(0,s.__)("permissions","vmfa-editorial-workflow"))),(0,a.createElement)(t.DropdownMenu,{icon:"admin-generic",label:(0,s.__)("Bulk actions","vmfa-editorial-workflow"),controls:_(e.key),className:"vmfa-bulk-menu"})),c[e.key]&&(0,a.createElement)("div",{className:"vmfa-role-folders"},(0,a.createElement)("table",{className:"vmfa-folders-table"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,(0,a.createElement)("th",null,(0,s.__)("Folder","vmfa-editorial-workflow")),r.map(l=>{const t=E(e.key,l.key),o=h(e.key,l.key);return(0,a.createElement)("th",{key:l.key,className:"vmfa-action-header-cell"},(0,a.createElement)("button",{type:"button",className:"vmfa-column-toggle",onClick:()=>b(e.key,l.key),title:t?(0,s.__)("Revoke all","vmfa-editorial-workflow"):(0,s.__)("Grant all","vmfa-editorial-workflow")},(0,a.createElement)("span",{className:"vmfa-column-indicator "+(t?"all":o?"some":"")}),l.label))}))),(0,a.createElement)("tbody",null,d.map(l=>(0,a.createElement)("tr",{key:l.id,className:l.isSystem?"vmfa-system-folder":""},(0,a.createElement)("td",{style:{paddingLeft:16*l.depth+8+"px"}},l.isSystem&&(0,a.createElement)("span",{className:"dashicons dashicons-lock",title:(0,s.__)("System folder","vmfa-editorial-workflow")}),l.name),r.map(o=>(0,a.createElement)("td",{key:o.key,className:"vmfa-checkbox-cell"},(0,a.createElement)(t.CheckboxControl,{checked:f(l.id,e.key,o.key),onChange:a=>v(l.id,e.key,o.key,a)}))))))))))))):(0,a.createElement)("div",{className:"vmfa-card"},(0,a.createElement)("div",{className:"vmfa-card-header"},(0,a.createElement)("h3",null,(0,s.__)("Folder Permissions","vmfa-editorial-workflow"))),(0,a.createElement)("div",{className:"vmfa-card-body"},(0,a.createElement)("p",{className:"vmfa-empty-state"},(0,s.__)("No roles or folders available.","vmfa-editorial-workflow"))))}function d({roles:e=[],folders:o=[],inboxMap:r={},onChange:n}){const i=(0,l.useMemo)(()=>{const e=[{value:"",label:(0,s.__)("Use workflow inbox","vmfa-editorial-workflow")}],a=(l,t="")=>{o.filter(e=>e.parent===l).forEach(l=>{e.push({value:String(l.id),label:t+l.name}),a(l.id,t+"— ")})};return a(0),e},[o]);return e.length?(0,a.createElement)("div",{className:"vmfa-card"},(0,a.createElement)("div",{className:"vmfa-card-header"},(0,a.createElement)("h3",null,(0,s.__)("Role Inbox Folders","vmfa-editorial-workflow"))),(0,a.createElement)("div",{className:"vmfa-card-body"},(0,a.createElement)("p",{className:"vmfa-card-description"},(0,s.__)('Override the default workflow inbox for specific roles. If not set, uploads will go to the "Needs Review" folder.',"vmfa-editorial-workflow")),(0,a.createElement)("div",{className:"vmfa-inbox-grid"},e.map(e=>(0,a.createElement)("div",{key:e.key,className:"vmfa-inbox-item"},(0,a.createElement)(t.SelectControl,{label:e.name,value:String(r[e.key]||""),options:i,onChange:a=>((e,a)=>{const l={...r};a?l[e]=parseInt(a,10):delete l[e],n(l)})(e.key,a)})))))):null}function f(){const[e,o]=(0,l.useState)(!0),[n,f]=(0,l.useState)(!1),[v,w]=(0,l.useState)(null),[u,k]=(0,l.useState)({}),[p,E]=(0,l.useState)({permissions:{},inbox:{},workflow:{enabled:!0,needsReviewFolder:"",approvedFolder:""}}),{roles:h,folders:b,actions:y,i18n:_}=window.vmfaSettings||{};(0,l.useEffect)(()=>{g(),N()},[]);const g=(0,l.useCallback)(async()=>{o(!0);try{const e=await r()({path:"/vmfa-editorial/v1/settings"});E(e)}catch(e){w({status:"error",message:e.message||_?.error||"Error loading settings."})}finally{o(!1)}},[_]),N=(0,l.useCallback)(async()=>{try{const e=await r()({path:"/vmfa-editorial/v1/stats"});k(e)}catch(e){console.warn("Could not load stats:",e)}},[]),C=(0,l.useCallback)(async()=>{f(!0),w(null);try{const e=await r()({path:"/vmfa-editorial/v1/settings",method:"POST",data:p});E(e),w({status:"success",message:_?.saved||"Settings saved."}),N()}catch(e){w({status:"error",message:e.message||_?.error||"Error saving settings."})}finally{f(!1)}},[p,_,N]),S=(0,l.useCallback)(e=>{E(a=>({...a,permissions:e}))},[]),x=(0,l.useCallback)(e=>{E(a=>({...a,inbox:e}))},[]),R=(0,l.useCallback)(e=>{E(a=>({...a,workflow:e}))},[]);return e?(0,a.createElement)("div",{className:"vmfa-settings-loading"},(0,a.createElement)(t.Spinner,null),(0,a.createElement)("p",null,(0,s.__)("Loading settings…","vmfa-editorial-workflow"))):(0,a.createElement)("div",{className:"vmfa-settings-panel"},v&&(0,a.createElement)(t.Notice,{status:v.status,isDismissible:!0,onRemove:()=>w(null),className:"vmfa-notice"},v.message),(0,a.createElement)(i,{stats:u}),(0,a.createElement)(c,{folders:b,workflow:p.workflow,onChange:R}),(0,a.createElement)(m,{roles:h,folders:b,actions:y,permissions:p.permissions,onChange:S}),(0,a.createElement)(d,{roles:h,folders:b,inboxMap:p.inbox,onChange:x}),(0,a.createElement)("div",{className:"vmfa-settings-actions"},(0,a.createElement)(t.Button,{variant:"primary",onClick:C,isBusy:n,disabled:n},n?(0,s.__)("Saving…","vmfa-editorial-workflow"):(0,s.__)("Save Changes","vmfa-editorial-workflow"))))}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("vmfa-settings-root");e&&(0,l.createRoot)(e).render((0,a.createElement)(f,null))})})();