(()=>{"use strict";var e={n:a=>{var l=a&&a.__esModule?()=>a.default:()=>a;return e.d(l,{a:l}),l},d:(a,l)=>{for(var t in l)e.o(l,t)&&!e.o(a,t)&&Object.defineProperty(a,t,{enumerable:!0,get:l[t]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.React,l=window.wp.element,t=window.wp.components,o=window.wp.apiFetch;var s=e.n(o);const r=window.wp.i18n;function n({value:e,label:l,color:t}){return(0,a.createElement)("div",{className:"vmfa-stat-item"},(0,a.createElement)("div",{className:"vmfa-stat-value",style:t?{color:t}:void 0},e),(0,a.createElement)("div",{className:"vmfa-stat-label"},l))}function i({stats:e={}}){const{totalMedia:l=0,needsReview:t=0,approved:o=0,rolesConfigured:s=0}=e;return(0,a.createElement)("div",{className:"vmfa-stats-card vmfa-card"},(0,a.createElement)(n,{value:l,label:(0,r.__)("Total Media","vmfa-editorial-workflow")}),(0,a.createElement)(n,{value:t,label:(0,r.__)("Needs Review","vmfa-editorial-workflow"),color:t>0?"#d63638":void 0}),(0,a.createElement)(n,{value:o,label:(0,r.__)("Approved","vmfa-editorial-workflow"),color:o>0?"#00a32a":void 0}),(0,a.createElement)(n,{value:s,label:(0,r.__)("Roles Configured","vmfa-editorial-workflow")}))}function c(e,{emptyLabel:a="",excludeSystem:l=!1,filter:t=null}={}){const o=[];a&&o.push({value:"",label:a});const s=(a,r="")=>{e.filter(e=>!(e.parent!==a||l&&e.isSystem||t&&!t(e))).forEach(e=>{o.push({value:String(e.id),label:r+e.name}),s(e.id,r+"— ")})};return s(0),o}function m({folders:e=[],workflow:o={},onChange:s}){const{editorsCanReview:n=!0,approvedFolder:i=""}=o,m=(0,l.useMemo)(()=>c(e,{emptyLabel:(0,r.__)('Use default "Approved" folder',"vmfa-editorial-workflow"),excludeSystem:!0}),[e]);return(0,a.createElement)("div",{className:"vmfa-card"},(0,a.createElement)("div",{className:"vmfa-card-header"},(0,a.createElement)("h3",null,(0,r.__)("Workflow Settings","vmfa-editorial-workflow"))),(0,a.createElement)("div",{className:"vmfa-card-body"},(0,a.createElement)("p",{className:"vmfa-card-description"},(0,r.__)('Media uploaded by non-admin roles will be placed in the "Needs Review" folder for editorial approval.',"vmfa-editorial-workflow")),(0,a.createElement)("div",{className:"vmfa-workflow-settings"},(0,a.createElement)(t.SelectControl,{label:(0,r.__)("Approved folder","vmfa-editorial-workflow"),help:(0,r.__)('Where approved media will be moved. Leave empty to use the default "Approved" system folder.',"vmfa-editorial-workflow"),value:String(i||""),options:m,onChange:e=>{s({...o,approvedFolder:e?parseInt(e,10):""})}}),(0,a.createElement)(t.CheckboxControl,{label:(0,r.__)("Allow Editors to review media","vmfa-editorial-workflow"),help:(0,r.__)("When enabled, Editors can access the Review page. When disabled, only Administrators can review.","vmfa-editorial-workflow"),checked:n,onChange:e=>{s({...o,editorsCanReview:e})}}))))}const d=window.wp.primitives,f=(0,a.createElement)(d.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,a.createElement)(d.Path,{d:"m19 7.5h-7.628c-.3089-.87389-1.1423-1.5-2.122-1.5-.97966 0-1.81309.62611-2.12197 1.5h-2.12803v1.5h2.12803c.30888.87389 1.14231 1.5 2.12197 1.5.9797 0 1.8131-.62611 2.122-1.5h7.628z"}),(0,a.createElement)(d.Path,{d:"m19 15h-2.128c-.3089-.8739-1.1423-1.5-2.122-1.5s-1.8131.6261-2.122 1.5h-7.628v1.5h7.628c.3089.8739 1.1423 1.5 2.122 1.5s1.8131-.6261 2.122-1.5h2.128z"}));function v({roles:e=[],folders:o=[],actions:s=[],permissions:n={},onChange:i}){const[c,m]=(0,l.useState)({}),d=["administrator"],v=["editor"],u=(0,l.useCallback)(e=>d.includes(e),[]),w=(0,l.useCallback)(e=>v.includes(e),[]),k=(0,l.useCallback)(e=>Object.values(n).some(a=>void 0!==a[e]),[n]),p=(0,l.useMemo)(()=>{const e=[],a=(l,t=0)=>{e.push({...l,depth:t}),o.filter(e=>e.parent===l.id).forEach(e=>a(e,t+1))};return o.filter(e=>0===e.parent).forEach(e=>a(e,0)),e},[o]),E=(0,l.useCallback)((e,a,l)=>{var t;return null!==(t=n[e]?.[a]?.includes(l))&&void 0!==t&&t},[n]),h=(0,l.useCallback)((e,a,l,t)=>{const r={...n};w(a)&&!k(a)&&o.forEach(e=>{r[e.id]||(r[e.id]={}),r[e.id][a]=s.map(e=>e.key)}),r[e]||(r[e]={}),r[e][a]||(r[e][a]=[]);const c=[...r[e][a]];if(t&&!c.includes(l))c.push(l);else if(!t){const e=c.indexOf(l);e>-1&&c.splice(e,1)}r[e][a]=c,i(r)},[n,o,s,w,k,i]),b=(0,l.useCallback)(e=>{const a={...n};o.forEach(l=>{a[l.id]||(a[l.id]={}),a[l.id][e]=s.map(e=>e.key)}),i(a)},[n,o,s,i]),y=(0,l.useCallback)(e=>{const a={...n};o.forEach(l=>{a[l.id]||(a[l.id]={}),a[l.id][e]=[]}),i(a)},[n,o,i]),_=(0,l.useCallback)((e,a)=>{const l={...n};o.forEach(t=>{l[t.id]||(l[t.id]={}),l[t.id][e]||(l[t.id][e]=[]),l[t.id][e].includes(a)||(l[t.id][e]=[...l[t.id][e],a])}),i(l)},[n,o,i]),g=(0,l.useCallback)((e,a)=>{const l={...n};if(w(e)){const t=s.filter(e=>e.key!==a).map(e=>e.key);o.forEach(o=>{l[o.id]||(l[o.id]={}),void 0===l[o.id][e]?l[o.id][e]=t:l[o.id][e]=l[o.id][e].filter(e=>e!==a)})}else Object.keys(l).forEach(t=>{l[t][e]&&(l[t][e]=l[t][e].filter(e=>e!==a))});i(l)},[n,o,s,w,i]),N=(0,l.useCallback)((e,a)=>!(!w(e)||k(e))||o.every(l=>n[l.id]?.[e]?.includes(a)),[n,o,w,k]),C=(0,l.useCallback)((e,a)=>!(!w(e)||k(e))||o.some(l=>n[l.id]?.[e]?.includes(a)),[n,o,w,k]),S=(0,l.useCallback)((e,a)=>{N(e,a)?g(e,a):_(e,a)},[N,g,_]),x=(0,l.useCallback)(e=>{let a=0;return Object.values(n).forEach(l=>{l[e]&&(a+=l[e].length)}),a},[n]),R=(0,l.useCallback)(e=>{const a=s.map(a=>({title:`${(0,r.__)("Grant","vmfa-editorial-workflow")} "${a.label}" ${(0,r.__)("to all folders","vmfa-editorial-workflow")}`,onClick:()=>_(e,a.key)})),l=s.map(a=>({title:`${(0,r.__)("Revoke","vmfa-editorial-workflow")} "${a.label}" ${(0,r.__)("from all folders","vmfa-editorial-workflow")}`,onClick:()=>g(e,a.key)}));return[{title:(0,r.__)("Grant all permissions","vmfa-editorial-workflow"),onClick:()=>b(e)},{title:(0,r.__)("Revoke all permissions","vmfa-editorial-workflow"),onClick:()=>y(e)},...a,...l]},[s,b,y,_,g]);return e.length&&o.length?(0,a.createElement)("div",{className:"vmfa-card"},(0,a.createElement)("div",{className:"vmfa-card-header"},(0,a.createElement)("h3",null,(0,r.__)("Folder Permissions","vmfa-editorial-workflow"))),(0,a.createElement)("div",{className:"vmfa-card-body"},(0,a.createElement)("p",{className:"vmfa-card-description"},(0,r.__)("Configure which roles can access each folder. Administrators and Editors have full access by default. Click column headers to toggle all.","vmfa-editorial-workflow")),(0,a.createElement)("div",{className:"vmfa-permissions-list"},e.map(e=>{const l=u(e.key),o=w(e.key),n=k(e.key),i=l||o&&!n;return(0,a.createElement)("div",{key:e.key,className:"vmfa-permission-role"},(0,a.createElement)("div",{className:"vmfa-role-header-row"},(0,a.createElement)("button",{type:"button",className:"vmfa-role-header",onClick:()=>{return a=e.key,void m(e=>({...e,[a]:!e[a]}));var a},"aria-expanded":c[e.key]},(0,a.createElement)("span",{className:"vmfa-role-toggle"},(0,a.createElement)("span",{className:`dashicons dashicons-arrow-${c[e.key]?"down":"right"}-alt2`})),(0,a.createElement)("span",{className:"vmfa-role-name"},e.name),i?(0,a.createElement)("span",{className:"vmfa-role-full-access"},(0,r.__)("Full access","vmfa-editorial-workflow"),o&&!l&&(0,a.createElement)("span",{className:"vmfa-default-badge"},(0,r.__)("default","vmfa-editorial-workflow"))):(0,a.createElement)("span",{className:"vmfa-role-count"},x(e.key)," ",(0,r.__)("permissions","vmfa-editorial-workflow"))),!l&&(0,a.createElement)(t.DropdownMenu,{icon:f,label:(0,r.__)("Bulk actions","vmfa-editorial-workflow"),controls:R(e.key),className:"vmfa-bulk-menu"})),c[e.key]&&(0,a.createElement)("div",{className:"vmfa-role-folders"},l&&(0,a.createElement)("p",{className:"vmfa-full-access-notice"},(0,a.createElement)("span",{className:"dashicons dashicons-yes-alt"}),(0,r.__)("This role has full access to all folders. Permissions cannot be restricted.","vmfa-editorial-workflow")),o&&!l&&!n&&(0,a.createElement)("p",{className:"vmfa-default-access-notice"},(0,a.createElement)("span",{className:"dashicons dashicons-info"}),(0,r.__)("This role has full access by default. Configure permissions below to override.","vmfa-editorial-workflow")),(0,a.createElement)("table",{className:"vmfa-folders-table"},(0,a.createElement)("thead",null,(0,a.createElement)("tr",null,(0,a.createElement)("th",null,(0,r.__)("Folder","vmfa-editorial-workflow")),s.map(t=>{const o=i||N(e.key,t.key),s=C(e.key,t.key);return(0,a.createElement)("th",{key:t.key,className:"vmfa-action-header-cell"},l?(0,a.createElement)("span",{className:"vmfa-column-label"},(0,a.createElement)("span",{className:"vmfa-column-indicator all"}),t.label):(0,a.createElement)("button",{type:"button",className:"vmfa-column-toggle",onClick:()=>S(e.key,t.key),title:o?(0,r.__)("Revoke all","vmfa-editorial-workflow"):(0,r.__)("Grant all","vmfa-editorial-workflow")},(0,a.createElement)("span",{className:"vmfa-column-indicator "+(o?"all":s?"some":"")}),t.label))}))),(0,a.createElement)("tbody",null,p.map(o=>(0,a.createElement)("tr",{key:o.id,className:o.isSystem?"vmfa-system-folder":""},(0,a.createElement)("td",{style:{paddingLeft:16*o.depth+8+"px"}},o.isSystem&&(0,a.createElement)("span",{className:"dashicons dashicons-lock",title:(0,r.__)("System folder","vmfa-editorial-workflow")}),o.name),s.map(s=>(0,a.createElement)("td",{key:s.key,className:"vmfa-checkbox-cell"},(0,a.createElement)(t.CheckboxControl,{checked:i||E(o.id,e.key,s.key),onChange:a=>h(o.id,e.key,s.key,a),disabled:l})))))))))})))):(0,a.createElement)("div",{className:"vmfa-card"},(0,a.createElement)("div",{className:"vmfa-card-header"},(0,a.createElement)("h3",null,(0,r.__)("Folder Permissions","vmfa-editorial-workflow"))),(0,a.createElement)("div",{className:"vmfa-card-body"},(0,a.createElement)("p",{className:"vmfa-empty-state"},(0,r.__)("No roles or folders available.","vmfa-editorial-workflow"))))}function u({roles:e=[],folders:o=[],inboxMap:s={},onChange:n}){const i=(0,l.useMemo)(()=>c(o,{emptyLabel:(0,r.__)("Use workflow inbox","vmfa-editorial-workflow")}),[o]);return e.length?(0,a.createElement)("div",{className:"vmfa-card"},(0,a.createElement)("div",{className:"vmfa-card-header"},(0,a.createElement)("h3",null,(0,r.__)("Role Inbox Folders","vmfa-editorial-workflow"))),(0,a.createElement)("div",{className:"vmfa-card-body"},(0,a.createElement)("p",{className:"vmfa-card-description"},(0,r.__)('Override the default workflow inbox for specific roles. If not set, uploads will go to the "Needs Review" folder.',"vmfa-editorial-workflow")),(0,a.createElement)("div",{className:"vmfa-inbox-grid"},e.map(e=>(0,a.createElement)("div",{key:e.key,className:"vmfa-inbox-item"},(0,a.createElement)(t.SelectControl,{label:e.name,value:String(s[e.key]||""),options:i,onChange:a=>((e,a)=>{const l={...s};a?l[e]=parseInt(a,10):delete l[e],n(l)})(e.key,a)})))))):null}function w(){const[e,o]=(0,l.useState)(!0),[n,c]=(0,l.useState)(!1),[d,f]=(0,l.useState)(null),[w,k]=(0,l.useState)(!1),[p,E]=(0,l.useState)({}),[h,b]=(0,l.useState)({permissions:{},inbox:{},workflow:{enabled:!0,needsReviewFolder:"",approvedFolder:""}}),{roles:y,folders:_,actions:g,i18n:N}=window.vmfaSettings||{};(0,l.useEffect)(()=>{C(),S()},[]),(0,l.useEffect)(()=>{if("success"===d?.status&&!w){const e=setTimeout(()=>{k(!0),setTimeout(()=>{f(null),k(!1)},300)},3e3);return()=>clearTimeout(e)}},[d,w]);const C=(0,l.useCallback)(async()=>{o(!0);try{const e=await s()({path:"/vmfa-editorial/v1/settings"});b(e)}catch(e){f({status:"error",message:e.message||N?.error||"Error loading settings."})}finally{o(!1)}},[N]),S=(0,l.useCallback)(async()=>{try{const e=await s()({path:"/vmfa-editorial/v1/stats"});E(e)}catch(e){console.warn("Could not load stats:",e)}},[]),x=(0,l.useCallback)(async()=>{c(!0),f(null);try{const e=await s()({path:"/vmfa-editorial/v1/settings",method:"POST",data:h});b(e),f({status:"success",message:N?.saved||"Settings saved."}),S()}catch(e){f({status:"error",message:e.message||N?.error||"Error saving settings."})}finally{c(!1)}},[h,N,S]),R=(0,l.useCallback)(e=>{b(a=>({...a,permissions:e}))},[]),M=(0,l.useCallback)(e=>{b(a=>({...a,inbox:e}))},[]),F=(0,l.useCallback)(e=>{b(a=>({...a,workflow:e}))},[]);return e?(0,a.createElement)("div",{className:"vmfa-settings-loading"},(0,a.createElement)(t.Spinner,null),(0,a.createElement)("p",null,(0,r.__)("Loading settings…","vmfa-editorial-workflow"))):(0,a.createElement)("div",{className:"vmfa-settings-panel"},d&&(0,a.createElement)(t.Notice,{status:d.status,isDismissible:!0,onRemove:()=>{k(!0),setTimeout(()=>{f(null),k(!1)},300)},className:"vmfa-notice"+(w?" is-dismissing":"")},d.message),(0,a.createElement)(i,{stats:p}),(0,a.createElement)(m,{folders:_,workflow:h.workflow,onChange:F}),(0,a.createElement)(v,{roles:y,folders:_,actions:g,permissions:h.permissions,onChange:R}),(0,a.createElement)(u,{roles:y,folders:_,inboxMap:h.inbox,onChange:M}),(0,a.createElement)("div",{className:"vmfa-settings-actions"},(0,a.createElement)(t.Button,{variant:"primary",onClick:x,isBusy:n,disabled:n},n?(0,r.__)("Saving…","vmfa-editorial-workflow"):(0,r.__)("Save Changes","vmfa-editorial-workflow"))))}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("vmfa-settings-root");e&&(0,l.createRoot)(e).render((0,a.createElement)(w,null))})})();