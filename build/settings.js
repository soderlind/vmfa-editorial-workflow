(()=>{"use strict";var e={n:a=>{var s=a&&a.__esModule?()=>a.default:()=>a;return e.d(s,{a:s}),s},d:(a,s)=>{for(var l in s)e.o(s,l)&&!e.o(a,l)&&Object.defineProperty(a,l,{enumerable:!0,get:s[l]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.wp.element,s=window.wp.apiFetch;var l=e.n(s);const o=window.wp.i18n,i=vmfo.shared,r=window.wp.components,d=window.ReactJSXRuntime;function t(){var e,s,t,n;const[c,m]=(0,a.useState)(null),[f,v]=(0,a.useState)(!0),w=(0,a.useCallback)(async()=>{try{const e=await l()({path:"/vmfa-editorial/v1/stats",method:"GET"});m(e)}catch(e){}finally{v(!1)}},[]);(0,a.useEffect)(()=>{w()},[w]);const h=c?[{label:(0,o.__)("Total Media","vmfa-editorial-workflow"),value:null!==(e=c.totalMedia?.toLocaleString())&&void 0!==e?e:"—"},{label:(0,o.__)("Needs Review","vmfa-editorial-workflow"),value:null!==(s=c.needsReview?.toLocaleString())&&void 0!==s?s:"—"},{label:(0,o.__)("Approved","vmfa-editorial-workflow"),value:null!==(t=c.approved?.toLocaleString())&&void 0!==t?t:"—"},{label:(0,o.__)("Roles Configured","vmfa-editorial-workflow"),value:null!==(n=c.rolesConfigured?.toLocaleString())&&void 0!==n?n:"—"}]:[{label:(0,o.__)("Total Media","vmfa-editorial-workflow"),isLoading:f},{label:(0,o.__)("Needs Review","vmfa-editorial-workflow"),isLoading:f},{label:(0,o.__)("Approved","vmfa-editorial-workflow"),isLoading:f},{label:(0,o.__)("Roles Configured","vmfa-editorial-workflow"),isLoading:f}];return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(i.StatsCard,{stats:h}),(0,d.jsxs)(r.Card,{className:"vmfo-overview-card",children:[(0,d.jsx)(r.CardHeader,{children:(0,d.jsx)("h3",{children:(0,o.__)("About Editorial Workflow","vmfa-editorial-workflow")})}),(0,d.jsxs)(r.CardBody,{children:[(0,d.jsx)("p",{children:(0,o.__)("Editorial Workflow provides a structured media approval process for your WordPress site. Media uploaded by contributors and authors is automatically placed in a review queue for editors to approve before publication.","vmfa-editorial-workflow")}),(0,d.jsx)("h4",{children:(0,o.__)("Features","vmfa-editorial-workflow")}),(0,d.jsxs)("ul",{children:[(0,d.jsx)("li",{children:(0,o.__)('Automatic "Needs Review" folder for new uploads from non-admin roles',"vmfa-editorial-workflow")}),(0,d.jsx)("li",{children:(0,o.__)("Granular folder permissions by role","vmfa-editorial-workflow")}),(0,d.jsx)("li",{children:(0,o.__)("Custom inbox folders per role","vmfa-editorial-workflow")}),(0,d.jsx)("li",{children:(0,o.__)("Dedicated review page for approving media","vmfa-editorial-workflow")}),(0,d.jsx)("li",{children:(0,o.__)("Configurable approved destination folder","vmfa-editorial-workflow")})]}),(0,d.jsx)("h4",{children:(0,o.__)("How It Works","vmfa-editorial-workflow")}),(0,d.jsxs)("ol",{children:[(0,d.jsx)("li",{children:(0,o.__)("Contributors upload media files","vmfa-editorial-workflow")}),(0,d.jsx)("li",{children:(0,o.__)('Files are automatically placed in the "Needs Review" folder',"vmfa-editorial-workflow")}),(0,d.jsx)("li",{children:(0,o.__)("Editors review and approve media from the Review page","vmfa-editorial-workflow")}),(0,d.jsx)("li",{children:(0,o.__)("Approved media moves to the designated folder","vmfa-editorial-workflow")})]})]})]})]})}function n(){var e,s,i,t;const[n,c]=(0,a.useState)(null),[m,f]=(0,a.useState)(!0),v=(0,a.useCallback)(async()=>{f(!0);try{const e=await l()({path:"/vmfa-editorial/v1/stats",method:"GET"});c(e)}catch(e){}finally{f(!1)}},[]);(0,a.useEffect)(()=>{v()},[v]);const w=window.vmfaSettings?.reviewPageUrl||"";return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(r.Card,{className:"vmfo-dashboard-card",children:[(0,d.jsx)(r.CardHeader,{children:(0,d.jsx)("h3",{children:(0,o.__)("Workflow Status","vmfa-editorial-workflow")})}),(0,d.jsx)(r.CardBody,{children:m?(0,d.jsxs)("div",{className:"vmfo-status-loading",children:[(0,d.jsx)(r.Spinner,{}),(0,d.jsx)("p",{children:(0,o.__)("Loading workflow status…","vmfa-editorial-workflow")})]}):(0,d.jsx)("div",{className:"vmfo-status-content",children:n?.needsReview>0?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"vmfo-status-alert vmfo-status-alert--warning",children:[(0,d.jsx)("span",{className:"vmfo-status-count",children:n.needsReview}),(0,d.jsx)("span",{className:"vmfo-status-label",children:(0,o.__)("media items awaiting review","vmfa-editorial-workflow")})]}),w&&(0,d.jsx)(r.Button,{variant:"primary",href:w,children:(0,o.__)("Go to Review Page","vmfa-editorial-workflow")})]}):(0,d.jsx)("div",{className:"vmfo-status-alert vmfo-status-alert--success",children:(0,d.jsx)("span",{className:"vmfo-status-label",children:(0,o.__)("No media items pending review. All caught up!","vmfa-editorial-workflow")})})})})]}),(0,d.jsxs)(r.Card,{className:"vmfo-dashboard-card",children:[(0,d.jsx)(r.CardHeader,{children:(0,d.jsx)("h3",{children:(0,o.__)("Workflow Summary","vmfa-editorial-workflow")})}),(0,d.jsx)(r.CardBody,{children:m?(0,d.jsx)(r.Spinner,{}):(0,d.jsxs)("div",{className:"vmfo-summary-grid",children:[(0,d.jsxs)("div",{className:"vmfo-summary-item",children:[(0,d.jsx)("span",{className:"vmfo-summary-value",children:null!==(e=n?.totalMedia)&&void 0!==e?e:"—"}),(0,d.jsx)("span",{className:"vmfo-summary-label",children:(0,o.__)("Total Media","vmfa-editorial-workflow")})]}),(0,d.jsxs)("div",{className:"vmfo-summary-item",children:[(0,d.jsx)("span",{className:"vmfo-summary-value vmfo-summary-value--warning",children:null!==(s=n?.needsReview)&&void 0!==s?s:"—"}),(0,d.jsx)("span",{className:"vmfo-summary-label",children:(0,o.__)("Needs Review","vmfa-editorial-workflow")})]}),(0,d.jsxs)("div",{className:"vmfo-summary-item",children:[(0,d.jsx)("span",{className:"vmfo-summary-value vmfo-summary-value--success",children:null!==(i=n?.approved)&&void 0!==i?i:"—"}),(0,d.jsx)("span",{className:"vmfo-summary-label",children:(0,o.__)("Approved","vmfa-editorial-workflow")})]}),(0,d.jsxs)("div",{className:"vmfo-summary-item",children:[(0,d.jsx)("span",{className:"vmfo-summary-value",children:null!==(t=n?.rolesConfigured)&&void 0!==t?t:"—"}),(0,d.jsx)("span",{className:"vmfo-summary-label",children:(0,o.__)("Roles Configured","vmfa-editorial-workflow")})]})]})})]}),(0,d.jsxs)(r.Card,{className:"vmfo-dashboard-card vmfo-info-card",children:[(0,d.jsx)(r.CardHeader,{children:(0,d.jsx)("h3",{children:(0,o.__)("Workflow Quick Actions","vmfa-editorial-workflow")})}),(0,d.jsx)(r.CardBody,{children:(0,d.jsxs)("ul",{className:"vmfo-quick-links",children:[w&&(0,d.jsx)("li",{children:(0,d.jsx)("a",{href:w,children:(0,o.__)("Review pending media","vmfa-editorial-workflow")})}),(0,d.jsx)("li",{children:(0,d.jsx)("a",{href:"upload.php",children:(0,o.__)("Media Library","vmfa-editorial-workflow")})})]})})]})]})}function c(e,{emptyLabel:a="",excludeSystem:s=!1,filter:l=null}={}){const o=[];a&&o.push({value:"",label:a});const i=(a,r="")=>{e.filter(e=>!(e.parent!==a||s&&e.isSystem||l&&!l(e))).forEach(e=>{o.push({value:String(e.id),label:r+e.name}),i(e.id,r+"— ")})};return i(0),o}function m({folders:e=[],workflow:s={},onChange:l}){const{editorsCanReview:i=!0,approvedFolder:t=""}=s,n=(0,a.useMemo)(()=>c(e,{emptyLabel:(0,o.__)('Use default "Approved" folder',"vmfa-editorial-workflow"),excludeSystem:!0}),[e]);return(0,d.jsxs)("div",{className:"vmfa-card",children:[(0,d.jsx)("div",{className:"vmfa-card-header",children:(0,d.jsx)("h3",{children:(0,o.__)("Workflow Settings","vmfa-editorial-workflow")})}),(0,d.jsxs)("div",{className:"vmfa-card-body",children:[(0,d.jsx)("p",{className:"vmfa-card-description",children:(0,o.__)('Media uploaded by non-admin roles will be placed in the "Needs Review" folder for editorial approval.',"vmfa-editorial-workflow")}),(0,d.jsxs)("div",{className:"vmfa-workflow-settings",children:[(0,d.jsx)(r.SelectControl,{label:(0,o.__)("Approved folder","vmfa-editorial-workflow"),help:(0,o.__)("Destination folder for approved media.","vmfa-editorial-workflow"),value:String(t||""),options:n,onChange:e=>{l({...s,approvedFolder:e?parseInt(e,10):""})}}),(0,d.jsx)(r.CheckboxControl,{label:(0,o.__)("Allow Editors to review media","vmfa-editorial-workflow"),help:(0,o.__)("Editors can access the Review page. Otherwise, only Administrators can review.","vmfa-editorial-workflow"),checked:i,onChange:e=>{l({...s,editorsCanReview:e})}})]})]})]})}const f=window.React,v=window.wp.primitives,w=(0,f.createElement)(v.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,f.createElement)(v.Path,{d:"m19 7.5h-7.628c-.3089-.87389-1.1423-1.5-2.122-1.5-.97966 0-1.81309.62611-2.12197 1.5h-2.12803v1.5h2.12803c.30888.87389 1.14231 1.5 2.12197 1.5.9797 0 1.8131-.62611 2.122-1.5h7.628z"}),(0,f.createElement)(v.Path,{d:"m19 15h-2.128c-.3089-.8739-1.1423-1.5-2.122-1.5s-1.8131.6261-2.122 1.5h-7.628v1.5h7.628c.3089.8739 1.1423 1.5 2.122 1.5s1.8131-.6261 2.122-1.5h2.128z"}));function h({roles:e=[],folders:s=[],actions:l=[],permissions:i={},onChange:t}){const[n,c]=(0,a.useState)({}),m=["administrator"],f=["editor"],v=(0,a.useCallback)(e=>m.includes(e),[]),h=(0,a.useCallback)(e=>f.includes(e),[]),u=(0,a.useCallback)(e=>Object.values(i).some(a=>void 0!==a[e]),[i]),p=(0,a.useMemo)(()=>{const e=[],a=(l,o=0)=>{e.push({...l,depth:o}),s.filter(e=>e.parent===l.id).forEach(e=>a(e,o+1))};return s.filter(e=>0===e.parent).forEach(e=>a(e,0)),e},[s]),k=(0,a.useCallback)((e,a,s)=>{var l;return null!==(l=i[e]?.[a]?.includes(s))&&void 0!==l&&l},[i]),x=(0,a.useCallback)((e,a,o,r)=>{const d={...i};h(a)&&!u(a)&&s.forEach(e=>{d[e.id]||(d[e.id]={}),d[e.id][a]=l.map(e=>e.key)}),d[e]||(d[e]={}),d[e][a]||(d[e][a]=[]);const n=[...d[e][a]];if(r&&!n.includes(o))n.push(o);else if(!r){const e=n.indexOf(o);e>-1&&n.splice(e,1)}d[e][a]=n,t(d)},[i,s,l,h,u,t]),_=(0,a.useCallback)(e=>{const a={...i};s.forEach(s=>{a[s.id]||(a[s.id]={}),a[s.id][e]=l.map(e=>e.key)}),t(a)},[i,s,l,t]),j=(0,a.useCallback)(e=>{const a={...i};s.forEach(s=>{a[s.id]||(a[s.id]={}),a[s.id][e]=[]}),t(a)},[i,s,t]),g=(0,a.useCallback)((e,a)=>{const l={...i};s.forEach(s=>{l[s.id]||(l[s.id]={}),l[s.id][e]||(l[s.id][e]=[]),l[s.id][e].includes(a)||(l[s.id][e]=[...l[s.id][e],a])}),t(l)},[i,s,t]),y=(0,a.useCallback)((e,a)=>{const o={...i};if(h(e)){const i=l.filter(e=>e.key!==a).map(e=>e.key);s.forEach(s=>{o[s.id]||(o[s.id]={}),void 0===o[s.id][e]?o[s.id][e]=i:o[s.id][e]=o[s.id][e].filter(e=>e!==a)})}else Object.keys(o).forEach(s=>{o[s][e]&&(o[s][e]=o[s][e].filter(e=>e!==a))});t(o)},[i,s,l,h,t]),b=(0,a.useCallback)((e,a)=>!(!h(e)||u(e))||s.every(s=>i[s.id]?.[e]?.includes(a)),[i,s,h,u]),N=(0,a.useCallback)((e,a)=>!(!h(e)||u(e))||s.some(s=>i[s.id]?.[e]?.includes(a)),[i,s,h,u]),C=(0,a.useCallback)((e,a)=>{b(e,a)?y(e,a):g(e,a)},[b,y,g]),S=(0,a.useCallback)(e=>{let a=0;return Object.values(i).forEach(s=>{s[e]&&(a+=s[e].length)}),a},[i]),R=(0,a.useCallback)(e=>{const a=l.map(a=>({title:`${(0,o.__)("Grant","vmfa-editorial-workflow")} "${a.label}" ${(0,o.__)("to all folders","vmfa-editorial-workflow")}`,onClick:()=>g(e,a.key)})),s=l.map(a=>({title:`${(0,o.__)("Revoke","vmfa-editorial-workflow")} "${a.label}" ${(0,o.__)("from all folders","vmfa-editorial-workflow")}`,onClick:()=>y(e,a.key)}));return[{title:(0,o.__)("Grant all permissions","vmfa-editorial-workflow"),onClick:()=>_(e)},{title:(0,o.__)("Revoke all permissions","vmfa-editorial-workflow"),onClick:()=>j(e)},...a,...s]},[l,_,j,g,y]);return e.length&&s.length?(0,d.jsxs)("div",{className:"vmfa-card",children:[(0,d.jsx)("div",{className:"vmfa-card-header",children:(0,d.jsx)("h3",{children:(0,o.__)("Folder Permissions","vmfa-editorial-workflow")})}),(0,d.jsxs)("div",{className:"vmfa-card-body",children:[(0,d.jsx)("p",{className:"vmfa-card-description",children:(0,o.__)("Configure which roles can access each folder. Administrators and Editors have full access by default. Click column headers to toggle all.","vmfa-editorial-workflow")}),(0,d.jsx)("div",{className:"vmfa-permissions-list",children:e.map(e=>{const a=v(e.key),s=h(e.key),i=u(e.key),t=a||s&&!i;return(0,d.jsxs)("div",{className:"vmfa-permission-role",children:[(0,d.jsxs)("div",{className:"vmfa-role-header-row",children:[(0,d.jsxs)("button",{type:"button",className:"vmfa-role-header",onClick:()=>{return a=e.key,void c(e=>({...e,[a]:!e[a]}));var a},"aria-expanded":n[e.key],children:[(0,d.jsx)("span",{className:"vmfa-role-toggle",children:(0,d.jsx)("span",{className:`dashicons dashicons-arrow-${n[e.key]?"down":"right"}-alt2`})}),(0,d.jsx)("span",{className:"vmfa-role-name",children:e.name}),t?(0,d.jsxs)("span",{className:"vmfa-role-full-access",children:[(0,o.__)("Full access","vmfa-editorial-workflow"),s&&!a&&(0,d.jsx)("span",{className:"vmfa-default-badge",children:(0,o.__)("default","vmfa-editorial-workflow")})]}):(0,d.jsxs)("span",{className:"vmfa-role-count",children:[S(e.key)," ",(0,o.__)("permissions","vmfa-editorial-workflow")]})]}),!a&&(0,d.jsx)(r.DropdownMenu,{icon:w,label:(0,o.__)("Bulk actions","vmfa-editorial-workflow"),controls:R(e.key),className:"vmfa-bulk-menu"})]}),n[e.key]&&(0,d.jsxs)("div",{className:"vmfa-role-folders",children:[a&&(0,d.jsxs)("p",{className:"vmfa-full-access-notice",children:[(0,d.jsx)("span",{className:"dashicons dashicons-yes-alt"}),(0,o.__)("This role has full access to all folders. Permissions cannot be restricted.","vmfa-editorial-workflow")]}),s&&!a&&!i&&(0,d.jsxs)("p",{className:"vmfa-default-access-notice",children:[(0,d.jsx)("span",{className:"dashicons dashicons-info"}),(0,o.__)("This role has full access by default. Configure permissions below to override.","vmfa-editorial-workflow")]}),(0,d.jsxs)("table",{className:"vmfa-folders-table",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{children:(0,o.__)("Folder","vmfa-editorial-workflow")}),l.map(s=>{const l=t||b(e.key,s.key),i=N(e.key,s.key);return(0,d.jsx)("th",{className:"vmfa-action-header-cell",children:a?(0,d.jsxs)("span",{className:"vmfa-column-label",children:[(0,d.jsx)("span",{className:"vmfa-column-indicator all"}),s.label]}):(0,d.jsxs)("button",{type:"button",className:"vmfa-column-toggle",onClick:()=>C(e.key,s.key),title:l?(0,o.__)("Revoke all","vmfa-editorial-workflow"):(0,o.__)("Grant all","vmfa-editorial-workflow"),children:[(0,d.jsx)("span",{className:"vmfa-column-indicator "+(l?"all":i?"some":"")}),s.label]})},s.key)})]})}),(0,d.jsx)("tbody",{children:p.map(s=>(0,d.jsxs)("tr",{className:s.isSystem?"vmfa-system-folder":"",children:[(0,d.jsxs)("td",{style:{paddingLeft:16*s.depth+8+"px"},children:[s.isSystem&&(0,d.jsx)("span",{className:"dashicons dashicons-lock",title:(0,o.__)("System folder","vmfa-editorial-workflow")}),s.name]}),l.map(l=>(0,d.jsx)("td",{className:"vmfa-checkbox-cell",children:(0,d.jsx)(r.CheckboxControl,{checked:t||k(s.id,e.key,l.key),onChange:a=>x(s.id,e.key,l.key,a),disabled:a})},l.key))]},s.id))})]})]})]},e.key)})})]})]}):(0,d.jsxs)("div",{className:"vmfa-card",children:[(0,d.jsx)("div",{className:"vmfa-card-header",children:(0,d.jsx)("h3",{children:(0,o.__)("Folder Permissions","vmfa-editorial-workflow")})}),(0,d.jsx)("div",{className:"vmfa-card-body",children:(0,d.jsx)("p",{className:"vmfa-empty-state",children:(0,o.__)("No roles or folders available.","vmfa-editorial-workflow")})})]})}function u({roles:e=[],folders:s=[],inboxMap:l={},onChange:i}){const t=(0,a.useMemo)(()=>c(s,{emptyLabel:(0,o.__)("Use workflow inbox","vmfa-editorial-workflow")}),[s]);return e.length?(0,d.jsxs)("div",{className:"vmfa-card",children:[(0,d.jsx)("div",{className:"vmfa-card-header",children:(0,d.jsx)("h3",{children:(0,o.__)("Role Inbox Folders","vmfa-editorial-workflow")})}),(0,d.jsxs)("div",{className:"vmfa-card-body",children:[(0,d.jsx)("p",{className:"vmfa-card-description",children:(0,o.__)('Override the default workflow inbox for specific roles. If not set, uploads will go to the "Needs Review" folder.',"vmfa-editorial-workflow")}),(0,d.jsx)("div",{className:"vmfa-inbox-grid",children:e.map(e=>(0,d.jsx)("div",{className:"vmfa-inbox-item",children:(0,d.jsx)(r.SelectControl,{label:e.name,value:String(l[e.key]||""),options:t,onChange:a=>((e,a)=>{const s={...l};a?s[e]=parseInt(a,10):delete s[e],i(s)})(e.key,a)})},e.key))})]})]}):null}function p(){const[e,s]=(0,a.useState)(!0),[i,t]=(0,a.useState)(!1),[n,c]=(0,a.useState)(null),[f,v]=(0,a.useState)(!1),[w,p]=(0,a.useState)({permissions:{},inbox:{},workflow:{editorsCanReview:!0,approvedFolder:""}}),{roles:k,folders:x,actions:_}=window.vmfaSettings||{};(0,a.useEffect)(()=>{j()},[]),(0,a.useEffect)(()=>{if("success"===n?.status&&!f){const e=setTimeout(()=>{v(!0),setTimeout(()=>{c(null),v(!1)},300)},3e3);return()=>clearTimeout(e)}},[n,f]);const j=(0,a.useCallback)(async()=>{s(!0);try{const e=await l()({path:"/vmfa-editorial/v1/settings"});p(e)}catch(e){c({status:"error",message:e.message||(0,o.__)("Error loading settings.","vmfa-editorial-workflow")})}finally{s(!1)}},[]),g=(0,a.useCallback)(async()=>{t(!0),c(null);try{const e=await l()({path:"/vmfa-editorial/v1/settings",method:"POST",data:w});p(e),c({status:"success",message:(0,o.__)("Settings saved.","vmfa-editorial-workflow")})}catch(e){c({status:"error",message:e.message||(0,o.__)("Error saving settings.","vmfa-editorial-workflow")})}finally{t(!1)}},[w]),y=(0,a.useCallback)(e=>{p(a=>({...a,permissions:e}))},[]),b=(0,a.useCallback)(e=>{p(a=>({...a,inbox:e}))},[]),N=(0,a.useCallback)(e=>{p(a=>({...a,workflow:e}))},[]);return e?(0,d.jsxs)("div",{className:"vmfa-settings-loading",children:[(0,d.jsx)(r.Spinner,{}),(0,d.jsx)("p",{children:(0,o.__)("Loading settings…","vmfa-editorial-workflow")})]}):(0,d.jsxs)("div",{className:"vmfa-configure-page",children:[n&&(0,d.jsx)(r.Notice,{status:n.status,isDismissible:!0,onRemove:()=>{v(!0),setTimeout(()=>{c(null),v(!1)},300)},className:"vmfa-notice"+(f?" is-dismissing":""),children:n.message}),(0,d.jsx)(m,{folders:x,workflow:w.workflow,onChange:N}),(0,d.jsx)(h,{roles:k,folders:x,actions:_,permissions:w.permissions,onChange:y}),(0,d.jsx)(u,{roles:k,folders:x,inboxMap:w.inbox,onChange:b}),(0,d.jsx)("div",{className:"vmfa-settings-actions",children:(0,d.jsx)(r.Button,{variant:"primary",onClick:g,isBusy:i,disabled:i,children:i?(0,o.__)("Saving…","vmfa-editorial-workflow"):(0,o.__)("Save Changes","vmfa-editorial-workflow")})})]})}function k(){const[e,s]=(0,a.useState)(null),[i,t]=(0,a.useState)(!1),n=window.vmfaSettings?.reviewPageUrl||"",c=(0,a.useCallback)(async()=>{t(!0),s(null);try{await l()({path:"/vmfa-editorial/v1/stats",method:"GET"}),s({type:"success",message:(0,o.__)("Statistics refreshed.","vmfa-editorial-workflow")}),window.dispatchEvent(new CustomEvent("vmfa-stats-refresh",{detail:{addonKey:"editorial-workflow"}}))}catch(e){s({type:"error",message:e.message||(0,o.__)("Failed to refresh statistics.","vmfa-editorial-workflow")})}finally{t(!1)}},[]);return(0,d.jsxs)(d.Fragment,{children:[e&&(0,d.jsx)(r.Notice,{status:e.type,isDismissible:!0,onRemove:()=>s(null),className:"vmfa-notice",children:e.message}),(0,d.jsxs)(r.Card,{className:"vmfo-actions-card",children:[(0,d.jsx)(r.CardHeader,{children:(0,d.jsx)("h3",{children:(0,o.__)("Review Actions","vmfa-editorial-workflow")})}),(0,d.jsxs)(r.CardBody,{children:[(0,d.jsx)("p",{className:"vmfo-description",children:(0,o.__)("Review and approve media from the dedicated Review page. Individual approval or batch operations are available there.","vmfa-editorial-workflow")}),(0,d.jsx)("div",{className:"vmfo-actions-buttons",children:n?(0,d.jsx)(r.Button,{variant:"primary",href:n,children:(0,o.__)("Go to Review Page","vmfa-editorial-workflow")}):(0,d.jsx)(r.Button,{variant:"primary",href:"upload.php?page=vmfa-review",children:(0,o.__)("Go to Review Page","vmfa-editorial-workflow")})})]})]}),(0,d.jsxs)(r.Card,{className:"vmfo-actions-card",children:[(0,d.jsx)(r.CardHeader,{children:(0,d.jsx)("h3",{children:(0,o.__)("Maintenance Actions","vmfa-editorial-workflow")})}),(0,d.jsxs)(r.CardBody,{children:[(0,d.jsx)("p",{className:"vmfo-description",children:(0,o.__)("Refresh workflow statistics to ensure counts are accurate.","vmfa-editorial-workflow")}),(0,d.jsx)("div",{className:"vmfo-actions-buttons",children:(0,d.jsx)(r.Button,{variant:"secondary",onClick:c,isBusy:i,disabled:i,children:i?(0,o.__)("Refreshing…","vmfa-editorial-workflow"):(0,o.__)("Refresh Statistics","vmfa-editorial-workflow")})})]})]}),(0,d.jsxs)(r.Card,{className:"vmfo-actions-card vmfo-info-card",children:[(0,d.jsx)(r.CardHeader,{children:(0,d.jsx)("h3",{children:(0,o.__)("About Review Workflow","vmfa-editorial-workflow")})}),(0,d.jsx)(r.CardBody,{children:(0,d.jsxs)("ol",{children:[(0,d.jsx)("li",{children:(0,o.__)('Non-admin users upload media, which lands in "Needs Review"',"vmfa-editorial-workflow")}),(0,d.jsx)("li",{children:(0,o.__)("Editors/Admins visit the Review page to see pending items","vmfa-editorial-workflow")}),(0,d.jsx)("li",{children:(0,o.__)("Approve individual items or use batch approve","vmfa-editorial-workflow")}),(0,d.jsx)("li",{children:(0,o.__)("Approved media moves to the configured destination folder","vmfa-editorial-workflow")})]})})]})]})}function x(){return(0,d.jsxs)(r.Card,{className:"vmfo-logs-card",children:[(0,d.jsx)(r.CardHeader,{children:(0,d.jsx)("h3",{children:(0,o.__)("Workflow Activity Logs","vmfa-editorial-workflow")})}),(0,d.jsx)(r.CardBody,{children:(0,d.jsx)("div",{className:"vmfo-addon-shell__empty-state",children:(0,d.jsx)("p",{children:(0,o.__)("Activity logging is coming in a future update. This will show a history of media approvals, rejections, and workflow changes.","vmfa-editorial-workflow")})})})]})}function _(){var e,s,r,c;const[m,f]=(0,a.useState)(null),[v]=(0,a.useState)(!0),w=(0,a.useCallback)(async()=>{try{const e=await l()({path:"/vmfa-editorial/v1/stats",method:"GET"});f(e)}catch(e){}},[]);(0,a.useEffect)(()=>{w()},[w]),(0,a.useEffect)(()=>{const e=e=>{"editorial-workflow"===e.detail?.addonKey&&w()};return window.addEventListener("vmfa-stats-refresh",e),()=>{window.removeEventListener("vmfa-stats-refresh",e)}},[w]);const h=m?[{label:(0,o.__)("Total Media","vmfa-editorial-workflow"),value:null!==(e=m.totalMedia?.toLocaleString())&&void 0!==e?e:"—"},{label:(0,o.__)("Needs Review","vmfa-editorial-workflow"),value:null!==(s=m.needsReview?.toLocaleString())&&void 0!==s?s:"—"},{label:(0,o.__)("Approved","vmfa-editorial-workflow"),value:null!==(r=m.approved?.toLocaleString())&&void 0!==r?r:"—"},{label:(0,o.__)("Roles Configured","vmfa-editorial-workflow"),value:null!==(c=m.rolesConfigured?.toLocaleString())&&void 0!==c?c:"—"}]:[];return(0,d.jsx)(i.AddonShell,{addonKey:"editorial-workflow",addonLabel:(0,o.__)("Editorial Workflow","vmfa-editorial-workflow"),enabled:v,stats:h,overviewContent:(0,d.jsx)(t,{}),dashboardContent:(0,d.jsx)(n,{}),configureContent:(0,d.jsx)(p,{}),actionsContent:(0,d.jsx)(k,{}),logsContent:(0,d.jsx)(x,{})})}function j(){const e=document.getElementById("vmfa-settings-root");e&&(0,a.createRoot)(e).render((0,d.jsx)(_,{}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",j):j()})();