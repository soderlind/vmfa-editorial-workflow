!function(){"use strict";const{nonce:e,i18n:t}=window.vmfaReview||{};function n(e,t=document){return t.querySelector(e)}function a(e,t=document){return t.querySelectorAll(e)}function s(){const e=a('input[name="vmfa-items[]"]:checked').length,t=n(".vmfa-selection-count");t&&(t.textContent=e>0?`${e} selected`:""),["#vmfa-bulk-approve","#vmfa-bulk-assign","#vmfa-assign-folder"].forEach(t=>{const a=n(t);a&&(a.disabled=0===e)})}const o=n("#vmfa-select-all");function i(){return Array.from(a('input[name="vmfa-items[]"]:checked')).map(e=>parseInt(e.value,10))}function c(e,t){e.style.transition="opacity 0.3s ease",e.style.opacity="0",setTimeout(()=>{e.remove(),t&&t()},300)}function r({action:t,data:n={},onSuccess:a,onError:s,onComplete:o}){const i=new FormData;i.append("action",t),i.append("nonce",e),Object.entries(n).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>i.append(`${e}[]`,t)):i.append(e,t)}),fetch(window.ajaxurl,{method:"POST",credentials:"same-origin",body:i}).then(e=>e.json()).then(e=>{e.success?a&&a(e):s&&s(e)}).catch(()=>{s&&s(null)}).finally(()=>{o&&o()})}o&&o.addEventListener("change",function(){const e=this.checked;a('input[name="vmfa-items[]"]').forEach(t=>{t.checked=e}),s()}),document.addEventListener("change",function(e){if(e.target.matches('input[name="vmfa-items[]"]')){s();const e=a('input[name="vmfa-items[]"]'),t=a('input[name="vmfa-items[]"]:checked'),o=n("#vmfa-select-all");o&&(o.checked=e.length===t.length)}});const d=n("#vmfa-bulk-approve");d&&d.addEventListener("click",function(){const e=i();if(0===e.length)return;if(!confirm(t?.confirmApprove||"Approve selected items?"))return;const a=this.textContent;this.disabled=!0,this.textContent=t?.saving||"Processing…",r({action:"vmfa_bulk_approve",data:{ids:e},onSuccess:t=>{e.forEach(e=>{const t=n(`.vmfa-review-item[data-id="${e}"]`);t&&c(t,f)}),l("success",t.data.message)},onError:e=>{l("error",e?.data?.message||t?.error||"An error occurred.")},onComplete:()=>{this.disabled=!1,this.textContent=a,s()}})});const m=n("#vmfa-bulk-assign");function l(e,t){const a=document.createElement("div");a.className=`notice notice-${e} is-dismissible`,a.innerHTML=`<p>${t}</p>`;const s=n(".wrap > h1");s&&s.insertAdjacentElement("afterend",a),setTimeout(()=>{c(a)},5e3)}function f(){if(0===a(".vmfa-review-item").length){const e=n(".vmfa-review-grid");if(e){const t=document.createElement("div");t.className="vmfa-review-empty",t.innerHTML="<p>No media items need review.</p>",e.replaceWith(t)}const t=n(".vmfa-review-actions");t&&(t.style.display="none")}}m&&m.addEventListener("click",function(){const e=i(),a=n("#vmfa-assign-folder"),o=a?.value;if(0===e.length||!o)return;const d=this.textContent;this.disabled=!0,this.textContent=t?.saving||"Processing…",r({action:"vmfa_bulk_assign",data:{ids:e,folder_id:o},onSuccess:t=>{e.forEach(e=>{const t=n(`.vmfa-review-item[data-id="${e}"]`);t&&c(t,f)}),l("success",t.data.message)},onError:e=>{l("error",e?.data?.message||t?.error||"An error occurred.")},onComplete:()=>{this.disabled=!1,this.textContent=d,a&&(a.value=""),s()}})}),document.addEventListener("click",function(e){const n=e.target.closest(".vmfa-approve-single");if(!n)return;const a=parseInt(n.dataset.id,10),s=n.textContent;n.disabled=!0,n.textContent="…",r({action:"vmfa_bulk_approve",data:{ids:[a]},onSuccess:()=>{const e=n.closest(".vmfa-review-item");e&&c(e,f)},onError:e=>{l("error",e?.data?.message||t?.error||"An error occurred."),n.disabled=!1,n.textContent=s}})}),document.addEventListener("DOMContentLoaded",s)}();