(()=>{"use strict";!function(){const{nonce:e,i18n:t}=window.vmfaReview||{},n=new Set;let a=!1;function s(e,t=document){return t.querySelector(e)}function o(e,t=document){return t.querySelectorAll(e)}function c(){const e=o('input[name="vmfa-items[]"]:checked').length,t=s(".vmfa-selection-count");t&&(t.textContent=e>0?`${e} selected`:""),o(".vmfa-media-card").forEach(e=>{const t=s('input[name="vmfa-items[]"]',e);e.classList.toggle("is-selected",t?.checked)});const n=s("#vmfa-destination-folder"),a=s("#vmfa-bulk-action");if(n&&(n.disabled=0===e),a){const t=n&&""!==n.value;a.disabled=0===e||!t}}const i=s("#vmfa-select-all");function d(e,t){e.style.transition="opacity 0.3s ease, transform 0.3s ease",e.style.opacity="0",e.style.transform="scale(0.95)",setTimeout(()=>{e.remove(),t&&t()},300)}function r({action:t,data:n={},onSuccess:a,onError:s,onComplete:o}){const c=new FormData;c.append("action",t),c.append("nonce",e),Object.entries(n).forEach(([e,t])=>{Array.isArray(t)?t.forEach(t=>c.append(`${e}[]`,t)):c.append(e,t)}),fetch(window.ajaxurl,{method:"POST",credentials:"same-origin",body:c}).then(e=>e.json()).then(e=>{e.success?a&&a(e):s&&s(e)}).catch(()=>{s&&s(null)}).finally(()=>{o&&o()})}i&&i.addEventListener("change",function(){const e=this.checked;o('input[name="vmfa-items[]"]').forEach(t=>{t.checked=e}),c()}),document.addEventListener("change",function(e){if(e.target.matches('input[name="vmfa-items[]"]')){c();const e=o('input[name="vmfa-items[]"]'),t=o('input[name="vmfa-items[]"]:checked'),n=s("#vmfa-select-all");n&&(n.checked=e.length===t.length,n.indeterminate=t.length>0&&t.length<e.length)}});const m=s("#vmfa-destination-folder");m&&m.addEventListener("change",function(){const e=s("#vmfa-bulk-action");if(e){const t=o('input[name="vmfa-items[]"]:checked').length>0;e.disabled=!t||""===this.value}});const l=s("#vmfa-bulk-action");function f(e){e.style.opacity="0",document.body.style.overflow="",setTimeout(()=>{e.remove()},200)}function v(e,t){o(".vmfa-notice").forEach(e=>e.remove());const n=document.createElement("div");n.className=`notice notice-${e} is-dismissible vmfa-notice`,n.innerHTML=`<p>${t}</p><button type="button" class="notice-dismiss"></button>`;const a=s(".vmfa-review-header");a&&a.insertAdjacentElement("afterend",n);const c=s(".notice-dismiss",n);c&&c.addEventListener("click",()=>d(n)),setTimeout(()=>{n.parentNode&&d(n)},5e3)}function u(){if(0===o(".vmfa-media-card").length){const e=s(".vmfa-review-grid");if(e){const t=document.createElement("div");t.className="vmfa-review-empty",t.innerHTML='\n\t\t\t\t\t<span class="dashicons dashicons-yes-alt"></span>\n\t\t\t\t\t<h2>All caught up!</h2>\n\t\t\t\t\t<p>No media items are waiting for review. New uploads will appear here.</p>\n\t\t\t\t',e.replaceWith(t)}const t=s(".vmfa-review-toolbar");t&&(t.style.display="none");const n=s(".vmfa-review-count-badge");n&&n.remove()}const e=o(".vmfa-media-card").length,t=s(".vmfa-review-count-badge");t&&e>0&&(t.textContent=e)}l&&l.addEventListener("click",function(){if(a)return;const e=Array.from(o('input[name="vmfa-items[]"]:checked')).map(e=>parseInt(e.value,10)).filter(e=>!n.has(e)),i=s("#vmfa-destination-folder")?.value;if(0===e.length||!i)return;const m="approve"===i;if(!confirm(m?t?.confirmApprove||"Approve selected items?":t?.confirmMove||"Move selected items to this folder?"))return;a=!0,e.forEach(e=>n.add(e));const l=this.textContent;this.disabled=!0,this.textContent=t?.saving||"Processingâ€¦",r({action:m?"vmfa_bulk_approve":"vmfa_bulk_assign",data:m?{ids:e}:{ids:e,folder_id:i},onSuccess:t=>{e.forEach(e=>{const t=s(`.vmfa-media-card[data-id="${e}"]`);t&&d(t,u)}),v("success",t.data.message)},onError:a=>{v("error",a?.data?.message||t?.error||"An error occurred."),e.forEach(e=>n.delete(e))},onComplete:()=>{this.disabled=!1,this.textContent=l,a=!1;const e=s("#vmfa-destination-folder");e&&(e.value=""),c()}})}),document.addEventListener("click",function(e){const a=e.target.closest(".vmfa-approve-single");if(!a)return;const s=parseInt(a.dataset.id,10);if(n.has(s))return;n.add(s);const o=a.closest(".vmfa-media-card");o&&o.classList.add("is-processing"),a.disabled=!0,r({action:"vmfa_bulk_approve",data:{ids:[s]},onSuccess:()=>{o&&d(o,u)},onError:e=>{v("error",e?.data?.message||t?.error||"An error occurred."),n.delete(s),a.disabled=!1,o&&o.classList.remove("is-processing")}})}),document.addEventListener("click",function(e){const t=e.target.closest(".vmfa-card-thumbnail");if(!t)return;if(e.target.closest(".vmfa-card-checkbox"))return;const n=t.dataset.full,a=t.dataset.title;n&&function(e,t){const n=document.createElement("div");n.className="vmfa-modal-overlay",n.innerHTML=`\n\t\t\t<div class="vmfa-modal-content">\n\t\t\t\t<button type="button" class="vmfa-modal-close">\n\t\t\t\t\t<span class="dashicons dashicons-no-alt"></span>\n\t\t\t\t</button>\n\t\t\t\t<img src="${e}" alt="${t}" class="vmfa-modal-image" />\n\t\t\t\t<div class="vmfa-modal-details">\n\t\t\t\t\t<h3 class="vmfa-modal-title">${t}</h3>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,document.body.appendChild(n),document.body.style.overflow="hidden",n.addEventListener("click",function(e){(e.target===n||e.target.closest(".vmfa-modal-close"))&&f(n)}),document.addEventListener("keydown",function e(t){"Escape"===t.key&&(f(n),document.removeEventListener("keydown",e))})}(n,a)}),document.addEventListener("DOMContentLoaded",c)}()})();